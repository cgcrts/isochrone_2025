<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Carte isochrone interactive des transports publics suisses</title>

        <!-- scripts -->
        <script src="https://rtsinfo-data.s3.amazonaws.com/js_scripts/autoresize.js"></script>

        <!-- styles -->
        <link rel="icon" type="image/ico" href="./assets/images/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
        <link rel="stylesheet" type="text/css" href="styles/app.css" />
        <link rel="stylesheet" type="text/css" href="styles/about.css" />
        <link rel="stylesheet" type="text/css" href="styles/form.css" />
        <link rel="stylesheet" type="text/css" href="styles/legend.css" />
    </head>

    <body class="no-scroll">
        <div class="appContent">
            <div class="formContainer">
                <form id="form">
                    <div class="geoOptions">
                        <label>Choix du point de départ</label>
                        <div class="formCheckbox geoOptionsCheckbox">
                            <label for="geoOptionsSelect" class="">
                                <img src="assets/images/markerSD.png" alt="marker">Sur la carte
                            </label>
                            <input type="checkbox" class="formCheckboxInput" id="geoOptionsSelect">
                            <label for="geoOptionsSelect" class="selected">
                                <img src="assets/images/logo_train.png" alt="train">Gare
                            </label>
                        </div>
                    </div>
                    <div class="formGrid" id="simpleOptions">
                        <div class="form-group" id="ctrls-point-1">
                            <label>Lieu de départ n°1</label>
                            <div class="locationInput">
                                <button class="btn btn-secondary hidden" id="select-origin-point-1" type="button">
                                    <span class="btn-content-initial">
                                        <img src="./assets/images/markerSD.png" width="15" alt="origin point"/>
                                        Choisir le point d'origine
                                    </span>
                                    <span class="btn-content-active hidden">Cliquer sur la carte</span>
                                    <span class="btn-content-selected hidden"></span>

                                </button>
                                <div class="input-wrapper">
                                    <input id="search-1" type="text" placeholder="Rechercher une gare..." autocomplete="off"/>
                                    <span class="clearBtn" id="clearBtn-1">✕</span>
                                    <div id="results-1" class="results"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group disabled hidden" id="ctrls-point-2">
                            <label>Lieu de départ n°2 (optionnel)</label>
                            <div class="locationInput">
                                <button disabled class="btn btn-secondary hidden" id="select-origin-point-2" type="button">
                                    <span class="btn-content-initial">
                                        <img src="./assets/images/markerRedSD.png" width="15" alt="origin point"/>
                                        Choisir le point d'origine
                                    </span>
                                    <span class="btn-content-active hidden">Cliquer sur la carte</span>
                                    <span class="btn-content-selected hidden"></span>
                                </button>
                                <div class="input-wrapper">
                                    <input id="search-2" type="text" placeholder="Rechercher une gare..." autocomplete="off"/>
                                    <span class="clearBtn" id="clearBtn-2">✕</span>
                                    <div id="results-2" class="results"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="time-limit">Limite de temps (en minutes)</label>
                            <input type="number" id="time-limit" min="10" max="480" value="60" required />
                        </div>
                    </div>

                    <div class="formCheckbox advancedOptionsCheckbox">
                        <input type="checkbox" class="formCheckboxInput" id="advancedOptionsSelect">
                        <label for="advancedOptionsSelect">Changer l'heure de départ</label>
                    </div>

                    <div class="formGrid" id="advancedOptions">
                        <div class="form-group">
                            <label for="departure-at">Date et heure de départ</label>
                            <input type="datetime-local" id="departure-at" required />
                        </div>

                        <div class="form-group">
                            <label for="isochrone-interval">Intervalle entre les isochrones</label>
                            <select id="isochrone-interval" required></select>
                        </div>
                        <div class="form-group">
                            <label>Heure de départ optimale</label>
                            <div class="formCheckbox">
                                <input type="checkbox" class="formCheckboxInput" id="find-optimal" />
                                <label for="find-optimal">Départ entre -30' et +30'</label>
                            </div>
                            <div class="optimalTimeLabel hidden" id="optimal-legend-1">
                                Départ optimal lieu 1
                                <span class="optimal-time">20:00</span>
                            </div>
                            <div class="optimalTimeLabel hidden" id="optimal-legend-2">
                                Départ optimal lieu 2
                                <span class="optimal-time">22:30</span>
                            </div>
                        </div>

                    </div>

                    <div class="submitButtonContainer">
                        <button class="btn" id="submit-button" type="submit" disabled>
                            <img src="./assets/images/target.png" width="20" height="20" alt="target"/>
                            Calculer
                        </button>
                    </div>

                </form>
            </div>

            <div class="map-container">
                <div id="map"></div>

                <!-- Toaster -->
                <div id="toast" class="hidden">
                    <div class="loader-container">
                        <div class="loader"></div>
                    </div>
                    <div id="toast-content">
                        <!-- <div id="toast-spacer"></div> -->
                        <p>Calcul de l'isochrone en cours...</p>
                        <p class="hidden noline">Calcul toujours en cours...</p>
                        <p class="hidden noline">Encore quelques secondes...</p>
                        <p class="hidden noline">C'est long...</p>
                        <p class="hidden noline">C'est long !</p>
                        <p class="hidden noline">C'est vraiment long...</p>
                        <!-- <p class="hidden">I'm an awesome toast!</p> -->
                        <!-- <p class="hidden">I'm an awesome toast!</p> -->
                    </div>
                </div>
            </div>

            <!-- Legend -->

            <div class="legendContainer hidden" id="legendContainer">
                <div class="legendDateTime">
                    Date et heure sélectionnées:
                    <span id="legendDate"></span> - <span id="legendTime"></span>
                </div>
                <div class="legendLabels">
                    <div class="legendLabel">Temps de parcours (en minutes) et</div>
                    <div class="legendLabel">surface couverte (en km²)</div>
                </div>

                <div class="legendContent">
                    <div class="legendBarLabel">
                        Lieu de départ 1
                    </div>
                    <div class="legendBar">
                        <div class="legendV2" id="legend"></div>
                        <div class="legendUnits">
                            <div class="legend-entry">
                                <div class="timelimit">min</div>
                                <div class="area">km²</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="legendContent hidden">
                    <div class="legendBarLabel">
                        Lieu de départ 2
                    </div>
                    <div class="legendBar">
                        <div class="legendV2" id="legend-2"></div>
                        <div class="legendUnits">
                            <div class="legend-entry">
                                <div class="timelimit">min</div>
                                <div class="area">km²</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn btn-secondary about" onclick="handleAboutButton()">A propos</button>

            <div id="aboutContainer" class="hidden" >
                <div id="aboutContent">
                    <div class="aboutCloseButton" onclick="handleCloseAbout()">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="#804a3e" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z" fill="fill"/></svg>
                    </div>
                    <div class="aboutTitle">
                        Calcul d'isochrones
                    </div>
                    <div class="aboutText">
                        <a href="https://iso.hepiapp.ch" target="_blank">Isochrones</a> est un
                        outil interactif pour visualiser les
                        <a href="https://fr.wikipedia.org/wiki/Carte_isochrone" target="_blank">cartes isochrones</a>
                        en Suisse. Ainsi, la plateforme permet de calculer et
                        comparer facilement les zones accessibles, à pieds et en
                        transports publics Suisses, en un temps donné depuis un
                        endroit en Suisse en fonction d'une heure de départ.
                    </div>
                    <div class="aboutTitle">
                        Source des données
                    </div>
                    <div class="aboutText">
                        Les données proviennent des
                        <a href="https://opendata.swiss/fr/dataset/timetable-54-2025-hrdf" target="_blank">horaires</a>
                        des transports publics Suisses.
                    </div>
                    <div class="aboutTitle">
                        Codes source
                    </div>
                    <div class="aboutText">
                        <div>
                            <a href="https://github.com/florianburgener/hrdf-parser" target="_blank">Parser HRDF</a>
                        </div>
                        <div>
                            <a href="https://github.com/florianburgener/hrdf-routing-engine" target="_blank">Planificateur de trajets</a>
                        </div>
                        <div>
                            <a href="https://github.com/florianburgener/interactive-isochrone-map" target="_blank">Site web</a>
                        </div>
                    </div>
                    <div class="aboutTitle">
                        Crédits
                    </div>
                    <div class="aboutText">
                        <a href="https://github.com/florianburgener" target="_blank">F. Burgener</a>, A. Durgnat,
                        <a href="https://github.com/Foebus" target="_blank">M. Gay-Balmaz</a>,
                        <a href="https://people.hes-so.ch/en/profile/4037691745-orestis-malaspinas" target="_blank">O. Malaspinas</a>.
                        <a href="https://www.hesge.ch/hepia" target="_blank">Haute école du paysage d'ingénierie et d'architecture</a>
                    </div>
                </div>
            </div>
        </div>

        <script
            type="text/javascript"
            src="https://unpkg.com/leaflet/dist/leaflet.js"
        ></script>
        <script
            type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"
        ></script>
        <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"
        ></script>
        <script type="text/javascript" src="script.js"></script>
    </body>
</html>
